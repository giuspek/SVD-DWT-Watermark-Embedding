function [found,att_WPSNR] = detection_pastolestogang(original,watermarked,attacked)
%% READING OF IMAGES
I_w    = imread(watermarked);
I    = imread(original);
I_ttk    = imread(attacked);

%% THRESHOLD, KEYS TO DECODE AND PARAMETERS
th = 0.10;
Vw = [-0.185091183619412 0.346814159120343 -0.0420135707231450 0.118398609649229 -0.260621883424316 0.00839996751150756 -0.265781811573038 0.111353896443302 0.0807348906214849 -0.0166189630919275 -0.102910573144037 0.161555951161227 0.0890226776529044 -0.0721012687152070 -0.00163969416605476 -0.0410848347100064 0.291195492170569 -0.210440810995177 -0.144538608551280 -0.166245959158961 0.0552785865327276 0.169052172135443 0.0277067979337934 0.115342748924549 -0.314186408704331 0.0388285224130557 0.00680971417586050 0.265275938329599 0.268543979510154 -0.0111344985722902 -0.261695144052991 -0.292688283854931;-0.147358790677303 -0.0595173826095740 0.111932420156985 0.435176150756163 0.00395001723171862 0.0436348188446473 0.105565504468910 -0.183903344160270 -0.121687806367175 -0.0907307524431973 -0.0290984321563627 -0.00127845635288113 -0.180559969856783 0.351364485795965 0.0941608062252806 0.265200212940736 0.131131190112044 -0.121550324450051 -0.0310399046392232 0.250015948559469 -0.0832944473406066 0.277318335518600 0.267958102936792 -0.229063455445334 -0.0111909561878838 -0.109282104349393 -0.109191491475287 -0.0585227760841287 0.320934163213240 0.0745793720852224 0.120369183512945 0.113073931612331;-0.192098023741617 -0.0794560699520694 0.241708621743801 0.0898340396768944 0.315555512120430 -0.170243850650320 0.252488325097474 0.0774852390503089 0.116955991399126 0.0576643997839835 0.182445694837061 0.105663428733693 -0.295094426305242 -0.233993619406045 -0.105832310599729 -0.0228797010293932 0.156564976137186 -0.341746088336318 -0.206521495334911 -0.124838674360324 -0.190444336890848 -0.111561490302616 -0.0556715103340455 0.0781116915764476 -0.0157004754474537 0.131684503403599 -0.392471089118445 -0.109948325430513 -0.108203244992415 -0.119125247235508 -0.0779498696561786 -0.0618668801189278;-0.147177266635254 -0.204046111214484 -0.0812818972217224 -0.0240523506838723 0.127855469829589 -0.0534735909125015 0.0328452095819002 0.00620498919840257 -0.454896634382555 0.115629037258882 -0.112279671646671 0.129899738320720 0.191811925818346 -0.106332381357155 -0.0181868429086373 -0.0835372251221845 -0.208369246913526 -0.0159544197580676 -0.532820115250231 0.0876013242850137 -0.0398024594962318 0.0252187122570895 0.123162109398917 0.207199063855652 -0.322336820054231 -0.0759843501453726 0.0936244334890417 0.145857725877348 -0.0468701202940252 0.0705317986722209 0.193216342513365 0.155636834615407;-0.118059897963590 -0.0228006969945766 0.0749455212942556 -0.114278015144868 0.150710276448611 0.0922984878866359 0.217258430681042 0.291248111305725 -0.246698383229818 0.243755404596629 -0.124714641174699 -0.00934730242675763 0.0647881045919249 0.383724949301165 -0.0385970919100102 0.0798564717233978 -0.153418440814857 -0.0263904256397524 0.228546915838576 -0.207894396629472 -0.0635627419321894 0.0977974155403719 -0.340179523618711 -0.0831592910195692 -0.122955719976215 -0.356787985904125 -0.150561546459434 0.0872198783461015 0.00318147128183055 0.0413228184707245 -0.253708041741014 -0.116929330501647;-0.167427989819893 -0.166201023262071 -0.0249308328361113 -0.104161498447148 0.189389278380575 -0.361783232459865 -0.152765978455839 -0.118877644608765 -0.0862057262158999 0.279711038791979 -0.0860996537250077 -0.0579677511440765 -0.0993294403733597 0.0142605393150880 0.248570164490261 -0.206663024207113 0.201753634689277 0.101344537526870 0.137490681781904 0.190904998370521 -0.0387379699341675 0.0253931960459721 -0.328172344761044 -0.0934544349138859 -0.152757419109150 0.279457009198897 0.214314995382366 -0.219655004381334 0.277232272289549 0.0703315931714756 0.0114683035164169 -0.123262540569816;-0.217827503653525 0.189644066912442 -0.00122176883147040 0.0234118805452751 0.294172298224070 0.251403141106269 -0.242578072351953 0.150912554321381 -0.280892060818157 0.0439833844000527 0.155335154914748 0.114739269544878 -0.169376708313239 0.102258865248082 0.155087019225028 0.0446776813739579 0.0101469604581261 -0.126834079209834 0.104291749677550 -0.159117706395282 0.329391413079476 -0.169902459903243 0.244026940834767 -0.110453130254749 0.0185191209392672 0.0622502249852318 0.234677255038337 -0.179418888774895 -0.199817326500229 -0.175183568565962 0.196759619538170 -0.197590060174038;-0.181059731585300 -0.157314926452104 0.390139116614130 0.00233009966929315 0.0407993097082789 0.298008240020850 -0.0662965617851212 -0.187154584659990 -0.128114116541934 0.0864382184624296 0.0339250223834865 -0.0731639348310997 0.192184264923475 -0.0538263232138174 -0.00901846928509480 -0.0181388886920662 0.159257626259646 0.191112924569595 0.218778185497421 -0.0757984395004406 -0.166571632399320 0.272979438990940 0.224260470874767 0.337514305875566 0.0368850903135279 0.229811416335817 0.0528898219732532 -0.0676801377204750 -0.206393236744258 0.132335290392130 -0.289513843059558 0.0477388844295297;-0.209216101607532 0.0655564402911105 0.0891079328249389 0.211121324056828 -0.354245941017152 -0.0813618861209727 0.260787522474786 0.0813819111834647 -0.167814276812302 0.156039115367553 0.144026744946939 -0.226916305188684 0.0800650909742869 -0.0534366520840369 -0.133457617143911 -0.190823015346563 0.254992784772224 -0.176610173377653 -0.111470192783156 0.0128431266956241 0.197420749695060 -0.186153975506579 -0.110286056285015 -0.0909584886738502 0.220428948685225 -0.160487741146069 0.342224281015995 -0.125059778670682 -0.0888306097348045 0.127137952540406 -0.149145832028187 0.219478580029259;-0.166273449112843 -0.251059206602296 -0.148530143206836 0.0675131332707609 -0.0391749688854167 -0.168656653004931 -0.0150441285655577 0.0250380774337268 0.184397456386426 -0.0391509232010845 0.298508093849055 -0.221901147792982 -0.00708882629614380 0.281895076785826 -0.218654846770691 -0.393669191414769 -0.196587450339804 -0.111629951750181 0.0440560405867751 -0.0947914492612994 -0.0300247283206946 0.347659863306342 0.121416625778110 0.160135121317609 0.0751477754732968 -0.0415744928161420 0.121622595268826 0.0979751572152257 -0.0205549318632230 -0.192822680771817 0.182271563384484 -0.262499832106549;-0.195817702134538 0.106007916111746 -0.0419506527466056 0.239371403854597 0.00809372718054509 -0.204966449168416 0.128773809233055 -0.0609006568759927 0.391794653504022 0.233532216203968 -0.337908933328697 0.0907235324309977 -0.0669338397236484 0.0291916801552053 -0.142187071846420 0.104775491210093 -0.270333701366714 0.0925289330930720 0.184559575769847 -0.137011108257135 0.166361996605944 -0.117786574489447 0.206649327145565 0.226273205152331 -0.277051087821083 -0.0499652803119130 0.119565666507864 -0.265540224559145 -0.0574199716340464 0.0727076555348388 0.00303637227227194 0.139377936586745;-0.126399873568397 0.0919794469420547 0.0622081240896441 0.139721722934791 0.313619886469731 -0.0426875939259703 0.0294657741497194 0.235580639972448 0.150597152845274 -0.312581232172182 0.154614980194991 0.163904904066836 0.362513830690444 -0.241600781420696 0.0429135336070491 -0.206123472944314 -0.0845388811881018 0.0173257665668378 0.175889676294238 0.374730572373211 0.202632325477837 0.232997187820473 -0.0576973408471520 -0.182844227554971 -0.139790755441501 -0.139967173737087 -0.0272823373112016 -0.0770171522942494 -0.0634648217258621 0.0426343636019958 -0.117574395190931 0.118147051768108;-0.124354084165691 -0.281695529225047 -0.0479006075566078 -0.00698917321988329 -0.114785199602138 0.0724716254910841 -0.243478117004836 -0.252958423577298 0.0791931731426233 -0.0501751618155419 -0.0693771216767045 0.154906169446928 0.146755122778198 0.149438814782590 -0.120441319516445 -0.0210515809032144 0.157800062751279 -0.265488944120776 0.0926198063801772 -0.135946350482554 0.314549504425660 -0.00721043237603156 -0.271909914806268 -0.0960722028053474 -0.0777028327041413 0.0756987042280928 -0.302402890528706 0.0398965810296154 -0.266871611339018 0.312821131633370 0.267065450106303 0.122124729540236;-0.172672686369892 -0.0681852921724140 -0.140100098255429 0.158096045453498 0.128520233109937 0.173215928303510 -0.321704336129666 0.165365610595219 0.0160744046654922 0.128984154315267 -0.207933811033055 -0.0871219480568389 -0.193657098302636 -0.0368637127918813 -0.387967042440281 -0.145130199623272 -0.192220891977625 0.154560725413604 -0.140459624980848 0.0265192722319137 -0.0209843143940457 -0.00319328735553960 0.0221089568103062 -0.354826177774022 0.203856572814259 0.263800998414024 -0.0801002755955304 0.145235934628887 0.0586964126868347 0.0111643929240276 -0.271460113854027 0.203364443685980;-0.151346059307551 -0.00133240462467445 0.0516567563457369 -0.0894699901890537 -0.152138102463721 -0.405903257315726 0.204862030254632 -0.0858235821975588 -0.241400673432414 -0.349685866619271 -0.108938070163097 0.00622367247850843 -0.0286874354638482 0.0457484164346749 -0.0945550815333861 0.142773911852505 0.0546450135579712 0.190885926678045 0.119432059757931 -0.150641204966094 0.0683847640029712 0.0627378504142088 0.0605940078184651 -0.284676268829245 -0.185272908093292 0.266696943769720 0.0417627693922684 0.196292926305847 -0.270186874462585 -0.324556165185011 -0.0882425608880299 0.0540578371811765;-0.191442470210827 0.116625196969744 -0.0341689085894595 0.245020901049188 -0.0263140274019601 -0.0630293548489711 -0.357895376347325 -0.0356797233261169 -0.140474883504992 -0.177913605751524 -0.163967048790391 -0.474644616999065 -0.0562041058473343 -0.278802783340659 0.163581404538460 0.0561656721187386 -0.0943248550820325 -0.0787081901421294 0.154023889141637 -0.0711845901025009 -0.290986834627017 -0.0183099994326600 -0.200057691996389 0.104727571757409 -0.0406563337540125 -0.273758969555400 -0.109787213352117 -0.0392747480750010 -0.156719668469682 -0.125998550197820 0.148116524857129 0.0877819582353806;-0.138937643693301 0.271970121698093 -0.187854756323833 -0.0563710617062547 -0.0641989915589487 -0.110994377535507 -0.0345404704613410 -0.0638471082015986 -0.222076334385206 0.0702156017591704 0.112591715080899 0.386489445603105 -0.0345910481407922 0.0234917043405152 -0.221324727396979 0.121009757224387 -0.133541659141500 -0.244484174743179 0.326366413978850 0.269641075467819 -0.186977790348518 0.0392219975706939 -0.144699422255982 0.299382832191812 0.269581653253682 0.146626251077491 0.0476667589854810 0.111673735791019 0.0442696665843516 -0.0703586691645252 0.0446837956967225 0.207743727238454;-0.197866473581975 0.0228141394425335 -0.409649206803392 -0.00267553777384527 0.139105643384851 -0.0783862974920829 0.117841047332552 -0.285248563870324 0.0536695767453981 0.0887668458565216 -0.0875306797003338 0.0428443391172210 -0.111675011258331 -0.0879776948511670 0.316971104384589 0.104294366917419 0.0564838101669373 0.119335337548815 -0.184585065397216 0.0330759602052031 0.234943652941111 0.244834729391829 -0.0192209599540569 0.0823247380077030 0.365088567631828 -0.185885896024364 -0.0813373990058059 0.112126590244901 -0.251067597121348 0.0288479335174903 -0.271837445186687 -0.142350235400441;-0.195786713779717 -0.0678944748811610 0.275075559184137 -0.191839849469685 -0.00655777190255100 0.0334564116739731 0.0369060841087829 0.00329654998465942 0.186473841884874 0.0272087369292870 -0.484796532108210 -0.0729756638374796 0.355720644317103 0.0585345118521899 0.0883283365151382 0.0721009817295122 -0.101326255997094 -0.340106505204599 -0.0925131289013122 0.225600845474867 -0.0145125838576412 -0.0964763922699685 0.0591485912883866 -0.0755876453289616 0.299749802338186 0.0822736666023897 0.0722875837726256 0.0322755527792289 0.00818572906660472 -0.281890632932706 0.0673939011121070 -0.179282182550969;-0.214209957644130 -0.0162541893748966 0.168169835952952 -0.253414563337087 -0.328124929315340 0.198441030861391 0.106649350570521 0.00243456166307843 -0.0930367581284892 -0.0777338579361890 0.0207604245493495 -0.0711697565828760 -0.316041353132969 -0.307744508521101 -0.152312650744962 0.136658563553194 -0.303114723885318 0.0633316599874918 -0.0447158493141874 0.157835528826454 0.281272838071769 0.253126345237163 -0.159417988379941 0.0167650224350236 -0.0598441097195187 0.0225142813020147 -0.0798793142510424 -0.227908897401860 0.146851413747188 0.0798391866736374 0.0963225326707186 -0.234423619433014;-0.145742136637361 -0.215440877027775 -0.0845196925691962 0.332242703010388 -0.0860302471516119 -0.0373592027694811 0.104114332736162 0.102016146883623 -0.0967434751866622 0.183554552454516 0.119292131492531 0.0202492606342952 0.243898080906663 -0.231970119748037 -0.0620233834979508 0.166545046900009 0.0337816361386066 0.282110817839888 0.231237878397320 0.0972273732662944 0.0260418063173940 -0.324894179470638 0.0883935683207855 -0.0152020075420926 0.0898753089233348 0.0408957872085001 -0.202169413582418 0.252297480320922 0.102427813567524 0.0533935326838447 0.175368320630333 -0.407302372215339;-0.153133631425903 0.135239342817558 0.369317204381210 -0.0429756488450679 0.0947743394835914 -0.0848868396380910 -0.223141468234000 -0.353874743355796 0.0312204332476486 -0.00681136567001686 0.199079308471186 0.0422579107542710 0.0378517161523418 0.184363076392376 -0.121529593098090 -0.0708881707635170 -0.0339288502701821 0.318223815925354 -0.153039447223326 0.0330963059730294 0.237029050715415 -0.243862553983230 -0.137000029026882 0.138829765563897 0.0542679518999379 -0.266894640171880 -0.143246117241314 0.105530560849282 0.218453203898078 -0.290244912449209 -0.0496471646020764 0.101308109518886;-0.160785547592388 -0.127751134670658 -0.335150966490504 -0.126837239908413 -0.154658909672492 0.113212446405939 -0.0948805979790008 -0.195475626834601 0.0164406989867180 0.0349614459820145 0.186546049105300 0.149252954174113 0.281792842088086 -0.0198966839280997 -0.151415569537251 0.132395215357406 0.0301094430814424 0.00590049491844199 -0.0822141629861007 -0.0384652940820521 -0.293247163698273 -0.0716422210865542 0.0575439136631401 -0.238870835506249 -0.120695397655931 -0.149347432371343 -0.0453940097685198 -0.511018804317014 0.0153608737944646 -0.254955782187292 -0.190728780082555 -0.0653576331688947;-0.171043758547593 0.173969536436687 -0.124944546959895 -0.199482850942964 0.234287431956271 0.0852079838189731 0.0380754285403008 0.157805351107807 0.210347431166861 0.0116844875586519 0.0357065479655818 -0.277000925855070 0.0291640420335910 0.115206284611081 -0.349687369365751 0.356528376913538 0.407311899192847 0.183132898598578 -0.139079182807775 0.216073042260476 -0.0627246819863895 0.0684075329933215 -0.107846036133646 0.0942286399538314 -0.111573553109698 -0.00497372663406864 0.131615423885440 0.0657970491892697 -0.136707823439224 0.0519970222325118 0.246050169466894 0.00365171838161964;-0.167782446084210 -0.142999365465109 0.0304015140002689 0.130742746071915 -0.0987439580937165 0.180697585494116 0.0889169293907302 0.219366696754319 0.0740009719432779 -0.219482462691004 -0.256058823839727 0.437338071029061 -0.120556013557983 -0.00661106886525796 0.0601388207716817 -0.197031827597769 0.221952806422924 0.327709380474007 -0.0544719083507200 -0.184027327715373 -0.177110854195956 0.0683757845831994 -0.218692770181121 0.0870405060223751 0.205458250607012 -0.120595513907321 0.139543851357341 -0.0979536469748598 0.0344131380110627 -0.148620389748408 0.266113509172043 0.0510784379805899;-0.248879878448400 -0.195650601547684 0.0361972079935924 -0.0917643894221813 -0.157432001229244 -0.0488689715979317 -0.155515539833470 0.154967949629628 0.128695788933406 -0.312507930496521 0.109102277076006 0.0842748534324221 -0.234000892874490 0.258266215197078 0.176570994884675 0.0513332881482409 -0.123094765793851 0.00919585556589883 -0.0587472517824518 0.283867221328400 -0.183578817672071 -0.373355699153794 0.0467134630427948 0.101320868724480 -0.0854300424882747 -0.0556274011276146 0.111159755195269 0.0837157115503753 -0.191703661929367 0.300455848746110 -0.268916053705712 -0.110752342238416;-0.185324151140438 0.00455786330251749 0.225577123891490 -0.193648349916776 -0.119618592121357 -0.171186472336793 -0.164039175814729 0.0938722717771353 0.236357034122392 0.332226293949991 0.269311084785399 0.145236831099292 0.00563160667488349 -0.175397907542636 0.211502730256535 0.208945808697256 -0.109040888295457 0.0402432942644814 -0.0179483999977351 -0.199664225548796 -0.173846765798239 0.199814456800115 0.0965750109965615 -0.322719653017372 0.0722953197540671 -0.136236500108230 0.129835716371465 0.227292557514897 -0.0388592053309828 0.113213302194493 0.182781956214229 0.203722313727501;-0.180227839158947 -0.187438744714139 -0.150160434745720 -0.294122338275366 0.0916832888635236 -0.202757021656952 -0.0585810329930480 0.277089250141512 -0.0784364698046519 -0.247431371559703 -0.0149900813478477 -0.133767173327126 0.102323585950162 -0.0384005307900394 0.0352522265550885 0.128051577821827 0.109758500069355 -0.0356834697756692 0.0855353730959957 -0.267557229615265 0.186462249469840 -0.0472780236401675 0.249565963592080 0.197595733354975 0.216327681924396 -0.0244403632948573 -0.154415217197333 -0.119727873687058 0.427394268904136 0.121389289285527 -0.0495244428759943 0.250085583331518;-0.202301698028665 0.271498352659168 -0.0685100033306071 -0.336052602267846 -0.0100624600943531 0.0879316441360269 0.176937105091062 -0.189698702236506 -0.0430814023788929 0.0278758927627513 -0.150457053333042 -0.0263157960914701 -0.115016449343725 -0.0539423737263933 -0.0448235679576532 -0.487272819790163 0.137124418212754 0.0397075998519687 0.194459070261880 0.0819365171806329 -0.171432213984892 -0.130755603058899 0.342243019617160 -0.171685059947924 -0.0588507969404406 -0.191132504709280 -0.215648860867772 0.101441935976598 0.00574080885035649 0.177480333720101 0.156020378016095 -0.0200590540718501;-0.166243941498914 0.437472724821398 -0.00193087226575120 0.0920533922725843 -0.0334203659259470 -0.0669858384271279 0.103729525737583 0.0271217201793436 -0.0194823479066499 -0.101918637544143 0.104084078046985 -0.0753652530721110 0.274040125800126 0.243790453038493 0.162116690758728 -0.0550895883049709 -0.241692598306288 0.174281953959581 -0.252729751938439 -0.179945868661478 -0.139635573690510 0.00298027436946050 -0.121506516471687 -0.0276800989566219 0.150512111208155 0.366603084412065 -0.197800197446432 -0.210556297994465 -0.0108940102871331 0.281140627254539 0.135427611228266 -0.0786474919533156;-0.108734616739205 -0.0295562554815935 -0.0231884282591858 0.0332851939387224 0.310240905407671 0.162135093562530 0.181475642818702 -0.381904020657889 0.0583150044995372 -0.295347887626584 0.0375787867645000 -0.00346037965235424 0.0329143335349763 -0.170157939717213 -0.131747150653012 0.0919188940112243 -0.147669442068207 -0.139217054420150 0.0420670389098825 -0.294221560902247 -0.113010285736655 -0.122695732216545 -0.158277477489966 -0.117751236573830 0.0111690326291280 -0.0132379795614074 0.419518754232329 0.193031137962064 0.249361143129506 0.227444605972980 -0.0319150387255112 -0.108091573214259;-0.230020539998205 -0.0651252741678618 -0.203494103691913 -0.0101573664403562 -0.0963521459079939 0.400346068721466 0.254474021178315 0.00648687595090629 0.177218181098381 0.0775037278763655 0.169826442409713 -0.156888034987470 -0.00826243363903564 0.0353503954664502 0.364810794315867 -0.0440396664265789 -0.0556375055819663 -0.0311733861604240 0.0663758384429643 0.0263307034994864 0.0709296407050391 -0.108320472993896 -0.120565448532677 0.0689452958340828 -0.239868928360254 0.252834145341361 -0.0687434736068574 0.207362508228884 0.124552426277968 -0.303391779674918 -0.00106470092694354 0.343213943195384];
a = 7;

lambda_max = zeros(1,1024);
O = zeros(8,8,1024);
O_U = zeros(8,8,1024);
O_S = zeros(8,8,1024);
O_V = zeros(8,8,1024);
E = zeros(8,8,1024);
E_U = zeros(8,8,1024);
E_S = zeros(8,8,1024);
E_V = zeros(8,8,1024);
A = zeros(8,8,1024);
A_U = zeros(8,8,1024);
A_S = zeros(8,8,1024);
A_V = zeros(8,8,1024);
watermark_ext = zeros(32,32);
watermark_ttk = zeros(32,32);

%% DWT FOR ORIGINAL, WATERMARKED AND ATTACKED IMAGE
[LL,LH,HL,HH] = dwt2(I, 'haar');
[LLw,LHw,HLw,HHw] = dwt2(I_w, 'haar');
[LLt,LHt,HLt,HHt] = dwt2(I_ttk, 'haar');

%% DETECTION
index = 1;
for i = 1:8:256
    for j = 1:8:256
        % 8*8 DIVISION BLOCK OF ORIGINAL IMAGE AND SVD FOR EACH BLOCK
        O(:,:,index) = LL(i:i+7,j:j+7);
        [O_U(:,:,index), O_S(:,:,index), O_V(:,:,index)] = svd(O(:,:,index));
        % 8*8 DIVISION BLOCK OF WATERMARKED IMAGE AND SVD FOR EACH BLOCK
        E(:,:,index) = LLw(i:i+7,j:j+7);
        [E_U(:,:,index), E_S(:,:,index), E_V(:,:,index)] = svd(E(:,:,index));
        % 8*8 DIVISION BLOCK OF ATTACKED IMAGE AND SVD FOR EACH BLOCK
        A(:,:,index) = LLt(i:i+7,j:j+7);
        [A_U(:,:,index), A_S(:,:,index), A_V(:,:,index)] = svd(A(:,:,index));
        % EXTRACTION OF WATERMARK USING INVERSE FORMULA OF EMBEDDING
        watermark_ext(fix(i/8)+1,fix(j/8)+1) = (E_S(1,1,index) - O_S(1,1,index)) / a;
        watermark_ttk(fix(i/8)+1,fix(j/8)+1) = (A_S(1,1,index) - O_S(1,1,index)) / a;
        index = index + 1;
    end
end

% MULTIPLICATION OF ACTUAL PRINCIPAL COMPONENTS CALCULATED ABOVE AND RIGHT
% SINGULAR VALUES OF WATERMARK.
watermark_ext = watermark_ext * transpose(Vw);
watermark_ttk = watermark_ttk * transpose(Vw);

%% PEARSON CORRELATION COEEFICIENT TO DETERMINE PRESENCE OF WATERMARK
sim = corrcoef(watermark_ext,watermark_ttk);
sim = sim(2,1);

if isnan(sim)
   sim = 0; 
end

sim

found = abs(sim) >= th;
att_WPSNR = WPSNR(I_w, I_ttk);
end

